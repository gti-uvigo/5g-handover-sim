# End-to-End 5G HetNet Simulator with arbitrary handover algorithms



This repository contains a 5G HetNet Simulator designed to evaluate the performance of various handover algorithms in heterogeneous network environments. The simulator is built on top of the ns-3 network simulator and leverages the 5G-LENA module for realistic end-to-end network simulations. 

It provides a framework for simulating handover scenarios with arbitrary handover algorithms, allowing to test and compare different approaches to handover management in 5G networks.

Tested on:
* ns-3 3.41
* 5G-LENA 3.x.y

To run the simulator, you will need to have ns-3 and 5G-LENA installed. Please refer to the [5G-LENA documentation](https://cttc-lena.gitlab.io/nr/html/index.html#getting-started) for detailed instructions on how to set up ns-3 and 5G-LENA.

The rest of the instructions on how to install and run the simulator expect you to have a working installation of ns-3 and 5G-LENA in the root directory of the repository, specifically in the `ns-3-dev` folder.

To install ns-3 and 5G-LENA, follow these steps:

> **Note:** As part of the installation process, please remember to create a symbolic link from the `network-simulator` folder into the `ns-3-dev/scratch` folder. 
>```bash
>ln -s /path/to/network-simulator /path/to/ns-3-dev/scratch
>```


## Code structure

### Network Simulator (network-simulator/)
The first part of the code is implemented using C++ and is based on the ns-3 network simulator, specifically the 5G-LENA module. This part of the code is responsible for simulating the low-level network behavior, including the generation of traces and performance metrics.

### Handover Simulator (handover-simulator/)

The second part of the code is implemented using Python. This part focuses on high-level simulation and algorithm evaluation for handover scenarios.

This code provides an interface to configure and run simulations, analyze the simulation results, and evaluate different handover algorithms. They leverage the output generated by the network simulator,

In this folder there are several subfolders, ```src/``` for the source code, ```sc/``` for the scenario definition files, ```traces/``` with the traces of the ns-3 simulations and the results of the high level simulation. If traces folder are not present the handover simulator will generate them automatically.

The results of the handover simulation are stored inside the specific trace folder, in a subfolder named `results/`. Each algorithm has its own subfolder, and the results are stored in CSV files.

The handover simulator implements three different handover algorithms:
1. **3GPP Rel.15 based Algorithm**: This is the standard handover algorithm defined by 3GPP for 5G networks.
2. **Score Based Greedy Handover (SBGH/GTI)**: This proposed algorithm selects the target cell based on a scoring mechanism that takes into account various factors such as signal strength, bandwidth, and cell load. [Citation needed]
3. **Multi-agent DDQN based Handover**: This algorithm leverages a multi-agent Double Deep Q-Network (DDQN) approach to optimize handover decisions. [Citation needed]

## Interaction between Parts
1. The network simulator generates traces and performance metrics during the simulation of the 5G HetNet environment.
2. The handover simulator reads these traces and metrics, allowing for high-level analysis and evaluation of different handover algorithms.
3. The handover simulator evaluates the performance of the handover algorithms based on the traces generated by the network simulator.
## Setting up the enviroment:
You can set the environment in two ways:

1. Using Docker 
2. Native

### 1. Using Docker
1. Just execute docker-compose in the root directory:
```bash
docker-compose up -d
```
1. Make sure the following dependencies are installed:
* [Docker](https://www.docker.com/)
* [Docker Compose](https://docs.docker.com/compose/)

1. Please refer to the [Docker installation guide](https://docs.docker.com/engine/install/) and the [Docker Compose installation guide](https://docs.docker.com/compose/install/) for your specific distribution.

2. Ensure that the Docker services are up and running. You can check the status of the services by running:
```bash
sudo systemctl status docker.service
```
```bash
sudo systemctl status docker.socket
```
The user should be added to the docker group to interact without root privileges
```bash
sudo usermod -aG docker $USER
```
### 2.Native
Please refer to the [5G-LENA documentation](https://cttc-lena.gitlab.io/nr/html/index.html#getting-started) for detailed instructions on how to set up ns-3 and 5G-LENA.

## Building and Running the Project
 
To build and run the project, follow these instructions:

1. Open a terminal and navigate to the ns3-dev folder:

```bash
cd ns3-dev
```

2. Configure the build profile for optimized building by running the following command:
 
```bash
./ns3 configure --build-profile=optimized
```
3. Once the build process is complete, navigate to the handover-simulator folder:
```bash
cd ../handover-simulator/src
```
4. Start the handover simulator by running the following command:
```bash
python3 main.py
```


## Usage

The handover simulator can be run from the command line. To start the simulator, navigate to the `handover-simulator/src` directory and run the following command:

```bash
python3 main.py
```

The simulator accepts several command-line arguments. If an argument is not specified, the simulator will assume its default value. To see the list of available arguments and their default values, run:

```bash
python3 main.py --help
```

## Scenario Definition File



 The scenario definition files provide the parameters for the ns-3 simulation. The file is structured in several sections:

1. **Scenario dimensions**: This section defines the dimensions of the simulation environment. The format is `!MinX MaxX MinY MaxY`. 

2. **Bands data**: This section defines the frequency bands used in the simulation. Each band is represented by a line starting with `*` followed by the band ID, central frequency in Hz, user bandwidth in Hz, and gNB bandwidth in Hz.

3. **gNodeB Data**: This section defines the new gNodeBs (gNBs) used in the simulation. Each gNB is represented by a line containing the gNB ID, its position (X, Y, Z coordinates), the band it uses, its transmission power in dBm, and its radiation pattern (I for isotropic, H Hexagonal trisector pattern).

 Each gNB is defined in the format: `GNB_ID Position_X Position_Y Position_Z Band_ID Transmission_Power_dBm gNB_Type`.

`#` is used to denote single line comments, the parser will ignore it.

This as an example here is the sc.txt file that can be found in the ```handover-simulator/sc/``` folder


```
# Scenario definition file

# Scenario dimensions 
# MinX MaxX MinY MaxY
!-400 400 -200 200

# Bands data
# * Band_ID Central_Frequency_Hz User_Bandwidth_Hz GNB_Bandwidth_Hz
*0 3.5e9 20e6 400e6
*1 28e9 100e6 400e6

# gNodeB Data for Micro Line (Band 1)
# Format: GNB_ID Position_X Position_Y Position_Z Band_ID Transmission_Power_dBm gNB_Type
0 -200.0 50.0 3.0 1 23.0 I
1 -200 -50.0 3.0 1 23.0 I
2 0.0 50.0 3.0 1 23.0 I
3 0.0 -50.0 3.0 1 23.0 I
4 200.0 50.0 3.0 1 23.0 I
5 200 -50.0 3.0 1 23.0 I

# gNodeB Data for Macro Line (Band 0)
# Format: GNB_ID Position_X Position_Y Position_Z Band_ID Transmission_Power_dBm gNB_Type
6 0 150.0 20.0 0 53.0 H
7 0 -150.0 20.0 0 53.0 H
```

# Output format
The output format of the traces of ns-3 is a CSV per each simulation.
In a simulation with n UEs and m GNBs there are n*m simulations. Each simulation can be found in `<trace folder>/<number of node>/<number of gnb>/traces.csv`


In the subfolder `<trace folder>/results/` a number of folders can be found, one for each algorithm of handover.

## License

This repository contains two funtional components, each under different license:

- The **handover simulator** is distributed under the **MIT License**. The DDQN Agent code is based on code from [PacktPublishing/Advanced-Deep-Learning-with-Keras](https://github.com/PacktPublishing/Advanced-Deep-Learning-with-Keras).
- The **network simulator** is distributed under the **GNU General Public License v2 (GPL-2.0)**. It is based on code examples  from [5G-LENA](https://5g-lena.cttc.es/).
